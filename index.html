<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#4CAF50">
  <title>Offline Survey Form</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }
    .container { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 500px; margin:auto;}
    label { display:block; margin-bottom:5px; font-weight:bold;}
    input[type="text"], input[type="number"], select { width:calc(100% - 22px); padding:10px; margin-bottom:15px; border:1px solid #ddd; border-radius:4px;}
    button { background-color:#4CAF50; color:white; padding:10px 15px; border:none; border-radius:4px; cursor:pointer; font-size:16px; margin-right:10px;}
    button:hover { background-color:#45a049;}
    #statusMessage { margin-top:15px; padding:10px; border-radius:4px;}
    .success { background-color:#d4edda; color:#155724; border:1px solid #c3e6cb;}
    .error { background-color:#f8d7da; color:#721c24; border:1px solid #f5c6cb;}
    .info { background-color:#d1ecf1; color:#0c5460; border:1px solid #bee5eb;}
    #offlineData { margin-top:20px; border-top:1px solid #eee; padding-top:15px;}
    #offlineData ul { list-style-type:none; padding:0;}
    #offlineData li { background-color:#e9ecef; padding:10px; margin-bottom:5px; border-radius:4px; display:flex; justify-content:space-between; align-items:center;}
    #offlineData li button { background-color:#dc3545; padding:5px 10px; font-size:12px;}
    #offlineData li button:hover { background-color:#c82333;}
    .sync-btn{background-color:#007bff;} .sync-btn:hover{background-color:#0056b3;}
    .clear-btn{background-color:#6c757d;} .clear-btn:hover{background-color:#5a6268;}
    .online-status{text-align:center; padding:10px; margin-bottom:15px; border-radius:4px; font-weight:bold;}
    .online{background-color:#d4edda; color:#155724;}
    .offline{background-color:#f8d7da; color:#721c24;}
  </style>
</head>
<body>
  <div class="container">
    <h1>üìã Offline Survey Form</h1>
    <div id="onlineStatus" class="online-status"></div>
    <form id="surveyForm">
      <label for="name">Name:</label>
      <input type="text" id="name" name="name" required>
      <label for="age">Age:</label>
      <input type="number" id="age" name="age" min="1" max="150" required>
      <label for="gender">Gender:</label>
      <select id="gender" name="gender" required>
        <option value="">Select Gender</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Other">Other</option>
      </select>
      <button type="submit">üíæ Save Data (Local)</button>
      <button type="button" id="syncBtn" class="sync-btn">‚òÅÔ∏è Sync to Google Sheets</button>
    </form>
    <div id="statusMessage"></div>
    <div id="offlineData">
      <h2>Locally Saved Data (<span id="entryCount">0</span>)</h2>
      <ul id="dataList"></ul>
      <button type="button" id="clearLocalBtn" class="clear-btn">üóëÔ∏è Clear Local Data</button>
    </div>
  </div>
  <script>
    // Palitan mo ito ng iyong actual Apps Script Web App URL na tested mo!
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyOyRrpsXBXDT-7rEa_PfbLU5UU9oHYkLPHk0EMEo7cvntmpMBl_EvkUL0_jimCMIfhFA/exec';
    
    const surveyForm = document.getElementById('surveyForm');
    const syncBtn = document.getElementById('syncBtn');
    const clearLocalBtn = document.getElementById('clearLocalBtn');
    const statusMessage = document.getElementById('statusMessage');
    const dataList = document.getElementById('dataList');
    const entryCount = document.getElementById('entryCount');
    const onlineStatus = document.getElementById('onlineStatus');
    let offlineEntries = JSON.parse(localStorage.getItem('offlineEntries')) || [];
    function updateOnlineStatus() {
      if (navigator.onLine) {
        onlineStatus.textContent = 'üü¢ Online - You can sync data to Google Sheets';
        onlineStatus.className = 'online-status online';
      } else {
        onlineStatus.textContent = 'üî¥ Offline - Data will be saved locally';
        onlineStatus.className = 'online-status offline';
      }
    }
    function displayOfflineData() {
      dataList.innerHTML = '';
      entryCount.textContent = offlineEntries.length;
      if (offlineEntries.length === 0) {
        dataList.innerHTML = '<li>No data saved locally.</li>';
      } else {
        offlineEntries.forEach((entry, index) => {
          const li = document.createElement('li');
          li.innerHTML = `<span>${entry.name}, ${entry.age}, ${entry.gender}</span>
            <button data-index="${index}">Delete</button>`;
          dataList.appendChild(li);
        });
      }
    }
    surveyForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const newEntry = {
        name: document.getElementById('name').value,
        age: document.getElementById('age').value,
        gender: document.getElementById('gender').value,
        timestamp: new Date().toISOString()
      };
      offlineEntries.push(newEntry);
      localStorage.setItem('offlineEntries', JSON.stringify(offlineEntries));
      displayStatus('‚úÖ Data saved locally!', 'success');
      surveyForm.reset();
      displayOfflineData();
    });
    syncBtn.addEventListener('click', async function() {
      if (offlineEntries.length === 0) {
        displayStatus('‚ö†Ô∏è No offline data to sync.', 'error');
        return;
      }
      if (!navigator.onLine) {
        displayStatus('‚ö†Ô∏è You are offline. Please connect to the internet to sync.', 'error');
        return;
      }
      displayStatus('‚è≥ Syncing data to Google Sheets...', 'info');
      syncBtn.disabled = true;
      const successfulSyncs = [], failedSyncs = [];
      for (const entry of offlineEntries) {
        try {
          const formData = new URLSearchParams();
          // Dapat sakto ang field names na ito
          formData.append('name', entry.name);
          formData.append('age', entry.age);
          formData.append('gender', entry.gender);
          formData.append('timestamp', entry.timestamp || new Date().toISOString());
          await fetch(SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors', // note: for production, use 'no-cors', but for debugging, pwede tanggalin para makita errors!
            body: formData
          });
          successfulSyncs.push(entry);
          await new Promise(resolve => setTimeout(resolve, 500));
        } catch (error) {
          failedSyncs.push(entry);
        }
      }
      offlineEntries = failedSyncs;
      localStorage.setItem('offlineEntries', JSON.stringify(offlineEntries));
      displayOfflineData();
      if (successfulSyncs.length > 0) {
        displayStatus(`‚úÖ Successfully synced ${successfulSyncs.length} entries${failedSyncs.length>0 ? ', ‚ùå '+failedSyncs.length+' failed.' : ' to Google Sheets!'}`, 'success');
      } else {
        displayStatus('‚ùå No entries successfully synced. Check console for errors.', 'error');
      }
      syncBtn.disabled = false;
    });
    dataList.addEventListener('click', function(e) {
      if (e.target && e.target.nodeName === 'BUTTON') {
        const indexToDelete = parseInt(e.target.dataset.index);
        offlineEntries.splice(indexToDelete, 1);
        localStorage.setItem('offlineEntries', JSON.stringify(offlineEntries));
        displayOfflineData();
        displayStatus('üóëÔ∏è Entry deleted locally.', 'info');
      }
    });
    clearLocalBtn.addEventListener('click', function() {
      if (confirm('Are you sure you want to clear all locally saved data?')) {
        offlineEntries = [];
        localStorage.removeItem('offlineEntries');
        displayOfflineData();
        displayStatus('üóëÔ∏è All local data cleared.', 'info');
      }
    });
    function displayStatus(message, type) {
      statusMessage.textContent = message;
      statusMessage.className = `status ${type}`;
      setTimeout(() => {
        statusMessage.textContent = '';
        statusMessage.className = '';
      }, 5000);
    }
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then((registration) => {
            console.log('Service Worker registered successfully:', registration.scope);
          })
          .catch((error) => {
            console.log('Service Worker registration failed:', error);
          });
      });
    }
    updateOnlineStatus();
    displayOfflineData();
  </script>
</body>
</html>